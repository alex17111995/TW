//
   Created by Alex on 5/5/2016.

html
    head
        script(src='http://maps.googleapis.com/maps/api/js')
        script.
            var map;
            function loadMap() {
                map = new google.maps.Map(document.getElementById("map"), {
                    center: new google.maps.LatLng(47.165528, 27.560970)
                    , zoom: 13
                    , mapTypeId: google.maps.MapTypeId.ROADMAP
                    , disableDefaultUI: true
                });
            }
            google.maps.event.addDomListener(window, 'load', loadMap);
            var kidInformation = #{information} // variabila
            function drawStaticTargets() {
                var i = 0
                        , j = 0;
                for (i = 0; i < kidInformation.kids.length; i++) {
                    for (j = 0; j < kidInformation.kids[i].targets.length; j++) {
                        var drawntarget = new google.maps.Circle({
                            strokeColor: '#333F4F'
                            , strokeOpacity: 0.9
                            , strokeWeight: 1
                            , fillColor: '#333F4F'
                            , fillOpacity: 0.25
                            , map: map
                            , center: new google.maps.LatLng(kidInformation.kids[i].targets[j].latitude, kidInformation.kids[i].targets[j].longitude)
                            , radius: kidInformation.kids[i].targets[j].radius
                            , })
                    }
                }
            }
        script.
            function generateNotificationCode(type, sender, target) {
                var notificationType
                        , notificationText
                        , interactiveArea
                        , notificationCode;
                if (type == "management") {
                    notificationCode = "<div class=\"management-notification-card mdl-card mdl-shadow--16dp\">";
                    notificationType = "Management <br/> Request";
                    notificationText = sender + " has requested management rights for " + target;
                    interactiveArea = "<a class = \"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary\"> Accept </a> <a class = \"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\" > Decline </a>";
                } else if (type == "view") {
                    notificationCode = "<div class=\"viewing-notification-card mdl-card mdl-shadow--16dp\">";
                    notificationType = "Viewing <br/> Request";
                    notificationText = sender + " has requested viewing rights for " + target;
                    interactiveArea = "<a class = \"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary\"> Accept </a> <a class = \"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\" > Decline </a>";
                } else if (type == "alert") {
                    notificationCode = "<div class=\"alert-notification-card mdl-card mdl-shadow--16dp\">";
                    notificationType = "Alert!"
                    notificationText = target + " has left the area set by " + sender;
                    interactiveArea = "<a class = \"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\"> Dismiss </a>";
                }
                notificationCode += "<div class=\"mdl-card__title mdl-card--border\">";
                notificationCode += "<h2 class=\"mdl-card__title-text\">" + notificationType + "</h2>";
                notificationCode += "</div> <div class = \"mdl-card__supporting-text\" >" + notificationText + "</div>";
                notificationCode += "<div class = \"mdl-card__actions mdl-card--border\">" + interactiveArea + "</div></div>";
                return notificationCode;
            }
        script.
            function displayShit(type, sender, target) {
                var newNotification = document.createElement("p");
                var notificationCode = generateNotificationCode(type, sender, target);
                document.getElementById('notification-area').appendChild(newNotification).innerHTML = notificationCode;
            }
        script.
            function ajax_long_poll() {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (xhttp.readyState == 4 && xhttp.status == 200) {
                        console.log(xhttp.response);
                    }
                }
                xhttp.open("GET", "/ajax-get-notification?timestamp=-1", true);
                xhttp.send();
            }
            window.onload=ajax_long_poll
        title Kid Tracker
        meta(name='viewport', content='width=device-width, initial-scale=1')
        script(src='https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js')
        link(rel='stylesheet', href='https://storage.googleapis.com/code.getmdl.io/1.0.6/material.blue-red.min.css')
        link(rel='stylesheet', href='https://fonts.googleapis.com/icon?family=Material+Icons')
        link(rel='stylesheet', href='layout.css')
        link(rel='stylesheet', href='components.css')
    body(onload='drawStaticTargets()')
        .interface-area.mdl-layout.mdl-js-layout.mdl-layout--fixed-drawer
            .mdl-layout__drawer
                span.mdl-layout-title Title
                nav.mdl-navigation
                    a.mdl-navigation__link(href='') Link
                    a.mdl-navigation__link(href='') Link
                    a.mdl-navigation__link(href='') Link
                    a.mdl-navigation__link(href='') Link
            main.mdl-layout__content
                .page-content
                    #map(style='height: 100%;width: 100%;')
        #notification-area
            form
                input(type='button', onclick="displayShit('management','vladut','sorana')", value='Management')
                input(type='button', onclick="displayShit('view','vladut','sorana')", value='View')
                input(type='button', onclick="displayShit('alert','vladut','sorana')", value='Alert')
                input(type='button', onclick='drawStaticTargets()', value='StaticTargets')
        .search-bar
            .mdl-textfield.mdl-js-textfield.mdl-textfield--expandable
                label.mdl-button.mdl-js-button.mdl-button--icon(for='sample6')
                    i.material-icons search
                .mdl-textfield__expandable-holder
                    input#sample6.mdl-textfield__input(type='text')
                    label.mdl-textfield__label(for='sample-expandable') Expandable Input